#!/bin/bash
set -euo pipefail

echo "Installing JA4+..."
if [ ! -d "/usr/local/zeek/share/zeek/site/packages/ja4" ]; then
    apt-get update -qq && apt-get install -y -qq git ca-certificates 2>&1 | grep -v "debconf"
    zkg install --force https://github.com/FoxIO-LLC/ja4
    echo "JA4+ installed"
else
    echo "JA4+ already installed"
fi

echo "Starting Zeek directly on interface {{ capture_interface }}..."
mkdir -p /opt/zeek/logs
cd /opt/zeek/logs

# Run zeek directly - no zeekctl!
exec zeek -C -i {{ capture_interface }} \
    LogAscii::use_json=T \
    /usr/local/zeek/share/zeek/site/local.zeek \
    packages
