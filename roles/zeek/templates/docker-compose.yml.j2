services:
  zeek:
    image: zeek/zeek:{{ zeek_version }}
    container_name: zeek
    network_mode: host
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - ZEEK_INTERFACE={{ capture_interface }}
    entrypoint: /opt/zeek-entrypoint.sh
    volumes:
      - {{ zeek_log_path }}:/usr/local/zeek/logs
      - {{ base_directory }}/zeek/scripts:/usr/local/zeek/share/zeek/site:ro
      - {{ base_directory }}/zeek/zeek-entrypoint.sh:/opt/zeek-entrypoint.sh:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "zeekctl status || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
